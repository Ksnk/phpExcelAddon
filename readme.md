# caution

Сейчас делается перенос проекта с phpExcel на phpoffice, заодно с наворачиванием самого шаблонизатора. Проект в раздрае, пока не работоспособен.

**todo**: Предполагается использовать шаблонизатор для генерации документов с помощью FPDF - генерация простого html шаблона. Генерация документа Word. Генерация шаблона писем для оправки по почте. 

# Еще один шаблонизатор

Изначально, шаблонизатор предназначался для работы в phpExcel, что значит, что все основные конструкции языка полностью помещаются в одну ячейку.

Задумывался как "шаблонизатор без логики", однако не удержался и сделал его калькулятором.

Все теги и расширения вставляются в виде дополнительных функций класса `templater` (теги) и 
`filterClass` (функции). С одной стороны это мешает пониманию того, что написано, с другой 
стороны, позволяет не расползаться классу по множеству зависимых файлов. Пока в поиске 
правильного решения... 

Требования к особой скорости выполнения в этом случае не ставилось, так как вывод документа наружу не обязан быть моментальным, тем более сам phpExcel не особенно быстр.

## Упрощенное описание работы шаблонизатора для версии Excel.

Работа шаблонизатора заключается в выполнении  конструкций языка в каждой ячейке документа, сверху-вниз-справа-налево. При этом создается карта ячеек документа, каждая новая ячейка получает ссылку на ту, стили которой используются для ее генерации. 
Таким образом, на первом этапе выполняется вычисление всего массива данных, на втором этапе происходит модификация документа, используя копирование ячеек в нужные места, на последнем - данные заносятся в ячейки и документ выводится.

Данными для шаблонизатора служит ассоциативный массив. Возможна динамическая генерация данных. 

Конструкции языка заключены в двойные фигурные скобки `{{ }}`.

##Конструкции языка

### вывод значений
Основной конструкцией является ссылка на элемент массива данных. `item[23].name` для входного массива данных

    [ item: [ 0:...
     23:['name':'Товар №1', 'price': 234567 ...]
    ]

выведет `Товар №1`

Можно использовать не имена полей объекта, а  константные значения - цифры или литеральные значения, в этом случае нужно использовать вырезку. Цифры - обычное изображение числа, литералы заключены в одинарные или двойные кавычки

Например те же данные выводит конструкция `item[23]['name']` 

К ссылкам или литералам могут применяться функции. Функции записываются в суффиксной форме, либо в традиционной

Суффиксная запись `item[23].price|num2str` выведет цену прописью с рублями и копейками - 

То же самое можно записать в традиционной нотации
`num2str(item[23].price)`

### циклы

`for seller.bank as k,i` - полная форма записи цикла. Внутри тела цикла, до конструкции `endfor`, появляются 2 пременные `i` и `k`, которые будут ключем элемента массива и содержимым элемента масива.

`for seller.bank as i` - обычная форма записи цикла. Внутри тела цикла, до конструкции `endfor`, появляются 1 пременная `i`,которая будет содержимым элемента масива.

`for seller.bank` - сокращенная форма записи цикла. Внутри тела цикла, до конструкции `endfor`, появляются 1 пременная `bank`,которая будет содержимым элемента масива.

`[seller.bank` - компактная форма записи цикла. Внутри тела цикла, до конструкции `]`, появляются 1 пременная `bank`,которая будет содержимым элемента масива. Оставлена для совместимости с предыдущими версиями

Каждый раз, когда встречается описатель цикла, позиция, следующая за ней запоминается. Когда встречается конец цикла, проверяется, не достигнут ли последний элемент цикла, и, если не достигнут, указалель чтения перемещается на него.

Внутри тела цикла можно использовать функцию `index` - значение счетчика цикла от 1

### условные предложения

`if условие` ... `elseif условие` ... `else` ... `endif` - полная форма условного предложения.

### присвоения

`a=b` - в текущей области видимости заводится переменная `a`, которая принимает вычисленное значение `b`.

